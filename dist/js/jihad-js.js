!function(){var a=window.JihadCore={$win:$(window),$doc:$(document),$html:$("html"),$body:$("body")};a.blocks={},a.blockRegister=function(b){var c=b.getSelector();return c&&(a.blocks[c]=b),this},a.blocksRun=function(b){var c=b||document;return $.each(a.blocks,function(a,b){var d=$(c).filter(a).add($(a,c));d.length&&d.each(function(){b.run($(this))})}),this},a.isDefined=function(a){return null!=a};var b={};a.data=function(a,c){return arguments.length<2?b[a]:void(b[a]=c)},a.throttle=function(a,b){function c(){e=this,f=arguments,g?h=!0:(a.apply(e,f),g=setTimeout(function(){g=null,h&&(h=!1,c.apply(e,f))},b))}function d(){h=!1}var e,f,g=null,h=!1;return c.reset=d,c}}(),function(){var a=window.JihadBlock={};a.getSelector=function(){return null},a.getBindings=function(){return[]},a.isInitialized=function(a){return a.data("jihad-initialized")?!0:!1},a.applyBindings=function(a){$.each(this.getBindings(a),function(b,c){a.on.apply(a,c)})},a.initialize=function(a){},a.run=function(a){var b=this;$.each(a,function(){var a=$(this);b.isInitialized(a)||(a.data("jihad-initialized",1),b.initialize(a),b.applyBindings(a))})}}(),function(){var a=window.JihadForm={lock:null,lockSelector:null};a.getAction=function(a){return a.attr("action")},a.getMethod=function(a){return a.attr("method")||"POST"},a.getData=function(a){return a.serialize()},a.getLock=function(){return null===this.lock&&(this.lock=this.createLock()),this.lock},a.getLockSelector=function(){return this.lockSelector},a.createLock=function(){return new JihadLock(this.getLockSelector())},a.errorsHide=function(a){a.find('[role="error"]').hide()},a.errorsShow=function(a,b){var c=this;$.each(b,function(b,d){c.errorShow(a,b,d)})},a.errorShow=function(a,b,c){a.find('[role="error"][data-field="'+b+'"]').text(c.message).show()},a.errorGlobal=function(a,b){alert(b.message)},a.beforeSend=function(a){this.submitsDisable(a),this.getLock().lock(a)},a.afterSend=function(a){this.submitsEnable(a),this.getLock().unlock(a)},a.submitsDisable=function(a){a.find('[role="submit"]').prop("disabled",!0)},a.submitsEnable=function(a){a.find('[role="submit"]').prop("disabled",!1)},a.onSuccess=function(a,b,c,d){this.errorsHide(a),b&&b.result?b.result.errors?this.fail(a,b.result):this.success(a,b.result):this.errorGlobal(a,{message:"Something is wrong"})},a.onError=function(a,b,c,d){this.errorGlobal(a,{message:"Something is wrong"})},a.fail=function(a,b){this.errorsShow(a,b.errors)},a.success=function(a,b){},a.submit=function(a){var b=this,c=$(a);return this.getLock().isLocked(c)?!1:($.ajax(this.getAction(c),{beforeSend:function(){b.beforeSend(c)},complete:function(){b.afterSend(c)},dataType:"json",data:this.getData(c),type:this.getMethod(c),success:function(a,d,e){b.onSuccess(c,a,d,e)},error:function(a,d,e){b.onError(c,a,d,e)}}),!1)}}(),function(){window.JihadLock=function(a){this._toggle_selector=a||".js-lock-toggle",this.getToggleSelector=function(a){return this._toggle_selector},this.isLocked=function(a){return a.data("jihad-locked")?!0:!1},this.lock=function(a){a.data("jihad-locked",1),this.afterLock(a)},this.afterLock=function(a){a.find(this.getToggleSelector(a)).toggleClass("hidden")},this.unlock=function(a){a.data("jihad-locked",0),this.afterUnlock(a)},this.afterUnlock=function(a){a.find(this.getToggleSelector(a)).toggleClass("hidden")}}}(),function(){var a=window.JihadModal={active:null,tpl2id:{},preprocess:!0,context:null};a.getTpl=function(){return"modal"},a.getUrl=function(){return null},a.preprocessUrl=function(){var a=this.getUrl();if(this.preprocess){var b=JihadUrl.parse(a,!0);b.pathname+=".json",b.search=b.query,b.search.layouts=["layout_content"],a=JihadUrl.make(b)}return a},a.getData=function(){return{}},a.getMethod=function(){return"POST"},a.beforeSend=function(){},a.afterSend=function(){},a.getModal=function(){return $("#"+a.tpl2id[this.getTpl()])},a.onSuccess=function(a,b,c){a&&a.result?a.result.errors?this.fail(a.result):(this.successLayout(a.result),this.success(a.result)):this.errorGlobal({message:"Something is wrong"})},a.onError=function(a,b,c){this.errorGlobal({message:"Something is wrong"})},a.fail=function(a){this.errorGlobal({message:"Something is wrong"})},a.success=function(b){a.active=this.getModal(),this.getModal().modal("show")},a.successLayout=function(a){var b=this.getModal().find(".modal-content");b.html(a.layouts.layout_content)},a.errorGlobal=function(a){alert(a.message)},a.show=function(){var b;if(a.tpl2id[this.getTpl()])b=this.getModal();else{var b=JihadTpl.html(this.getTpl());a.tpl2id[this.getTpl()]=b.attr("id"),JihadCore.$body.append(b)}a.active=b;var c=this;return $.ajax(this.preprocessUrl(),{beforeSend:function(){c.beforeSend()},complete:function(){c.afterSend()},dataType:"json",data:this.getData(),type:this.getMethod(),success:function(a,b,d){c.onSuccess(a,b,d),JihadCore.blocksRun(c.getModal())},error:function(a,b,d){c.onError(a,b,d)}}),!1},a.hide=function(){a.active.modal("hide")}}(),function(){var a=window.JihadRowUpdater={container:null,data:{}};a.id=function(a){return a},a.run=function(){var a=$(this.container),b=this;$.each(this.data,function(c,d){var e=a.find("#"+b.id(c));e.length?d?(e.replaceWith(d),JihadCore.blocksRun(e)):e.remove():a.prepend(d)})}}(),function(){var a=window.JihadTpl={};["evaluate","interpolate","encode","use","define","conditional","iterate"].forEach(function(a){var b=this[a],c=b.source.replace(/\\{\\{/g,"\\[\\[").replace(/\\}\\}/g,"\\]\\]"),d=(b.global?"g":"")+(b.multiline?"m":"")+(b.ignoreCase?"i":"");this[a]=new RegExp(c,d)},doT.templateSettings),a.TPL_PREFIX="tpl-",a.cache={},a.helpers={params:function(a){return JSON.stringify(a)},include:function(b,c){return a.html(b,c)}},a.push=function(b,c){return a.cache[b]=doT.compile(c)},a.get=function(b){var c,d;return b&&(d=a.cache[b],void 0===d&&(c=$("#"+a.TPL_PREFIX+b),d=c.length?a.push(b,c.html().trim()):a.cache[b]=null)),d||null},a.text=function(b,c){var d=a.get(b);return d?d(c||{}):""},a.html=function(b,c){return $(a.text(b,c))}}(),function(){window.JihadUrl=function(a,b){function c(a,b){var c=null;return a&&(a=n(a),c=v.exec(a)),c&&(c={href:a,protocol:c[1],host:c[2]||"",hostname:c[3]||"",port:c[4]||"",pathname:c[5]||"",search:c[6]&&1!==c[6].length?c[6]:"",hash:c[7]&&1!==c[7].length?c[7]:""},c.path=c.pathname+c.search,c.isLocal=f(c),b&&(c.query=e(c.search))),c}function d(a){var b,c,d,e="";return a=a||{},e+=(a.protocol||location.protocol)+"//",e+=a.host?a.host:a.hostname?a.hostname+(a.port?":"+a.port:""):location.host,b=a.pathname,b&&"/"===b.charAt(0)&&(b=b.slice(1)),b&&(e+="/"+b),c=a.search,c&&("string"==typeof c?"?"===c.charAt(0)&&(c=c.slice(1)):c=A(c),c&&(e+="?"+c)),d=e.hash,d&&"#"===d.charAt(0)&&(d=d.slice(1)),d&&(e+="#"+d),e}function e(a){var b={};return a&&"?"===a.charAt(0)&&(a=a.slice(1)),a&&a.split("&").forEach(function(a){var c,d;a=a.split("="),c=B(a[0]),c&&(d=B(a.slice(1).join("=")),b[c]=d)}),b}function f(b){return"string"==typeof b&&(b=c(b)),b&&b.protocol===a.location.protocol&&b.host===a.location.host}function g(){return a.location.pathname+a.location.search}function h(){return i(a.location.href)}function i(a){return a.split("#").slice(1).join("#")}function j(a){return"//"===a.slice(0,2)?a.slice(1):a}function k(a){return"/"===a.charAt(0)?"/"+a:a}function l(b,c){c?a.location.replace("#"+b):a.location.hash=b}function m(a,b){return b?a+"#"+k(b):a}var n,o,p,q,r,s,t,u=/^\w+:\/\//i,v=/^(.+?:)\/\/(?:.+?(?::.+?)?@)?((.+?)(?::(\d+))?)(\/.*?)?(\?.*?)?(#.*)?$/,w=/\+/g,x=!(!a.history||!a.history.pushState),y=b.createElement("a"),z=g(),A=(j(h()),$.param.bind($)),B=function(a){return decodeURIComponent(a.replace(w,"%20"))};return y.href="a","a"===y.href?(p=b.createElement("div"),o=function(a){return p.innerHTML='<a href="'+a.replace(/"/g,"%22")+'"></a>',p.firstChild.href}):o=function(a){return y.href=a,y.href},n=function(a){return a=a||"",u.test(a)?a:o(a)},x?(q=function(a){return null==a?g():c(a).path},r=function(a){return j(null==a?h():i(a))},s=function(c){c?l(k(c),!0):a.history.replaceState({},b.title,g())}):(q=function(a){return null==a&&(a=h()),c(a).path},r=function(a){return null==a&&(a=h()),j(i(a))},s=function(a){l(m(q(),a),!0)}),{toAbsolute:n,parse:c,make:d,parseQuery:e,encodeQuery:A,isLocal:f,reload:function(){a.location.reload()},getPath:function(){return z},getQuery:function(){return c(z,!0).query},getHash:function(){return r()},getUrl:function(){return m(z,r())},getOrigin:function C(b){return b?(b=c(b),b.protocol+"//"+b.host):t=t||a.location.origin||C(a.location.href)},setHash:s}}(window,document)}(),function(){var a={};JihadCore.blockRegister($.extend(a,JihadBlock,{getSelector:function(){return".jh-list"},init:function(a){this.$=a,this._checkDistance=JihadCore.throttle(this._checkDistance.bind(this,a),500),JihadCore.$win.on("load scroll resize",this._checkDistance),this._checkDistance()},getMoreUrl:function(){var a,b;return this._noMore?null:(a=this.getMoreBtn(),b=!!a.length,b||(JihadCore.$win.off("load scroll resize",this._checkDistance),this._noMore=!0),b?a.data("more-url"):null)},getMoreBtn:function(){return this.$.find(this.getSelector()+"__more")},_checkDistance:function(a){var b,c,d=this,e=JihadCore.$win,f=this.getMoreUrl();f&&!this.request&&(b=e.scrollTop()+e.height(),c=a.offset().top+a.height(),1e3>c-b&&(this.getMoreBtn().unbind().remove(),this.request=$.ajax({url:f,dataType:"json",complete:function(){d.request=null}}).done(function(b){var c,d=b&&b.result||{};d.html&&(c=$(d.html),a.append(c),JihadCore.blocksRun(c))})))}}))}(),function(){var a={};JihadCore.blockRegister($.extend(a,JihadBlock,{getSelector:function(){return".jh-select"},getBindings:function(){return[["change",".jh-select__control",function(){var a=$(this),b=a.closest(".jh-select");b.find(".jh-select__placeholder").html(b.find("option:selected").html())}],["focus",".jh-select__control",function(){var a=$(this),b=a.closest(".jh-select");b.toggleClass("focus",!0)}],["blur",".jh-select__control",function(){var a=$(this),b=a.closest(".jh-select");b.toggleClass("focus",!1)}]]}}))}(),function(){var a={};JihadCore.blockRegister($.extend(a,JihadBlock,{getSelector:function(){return".jh-stick"},getBindings:function(){return[]},initialize:function(a){a.stick_in_parent(a.data("stick"))}}))}(),function(){var a={};JihadCore.blockRegister($.extend(a,JihadBlock,{getSelector:function(){return".jh-textarea"},getBindings:function(){return[]},initialize:function(a){JihadBlock.initialize(a);var b=a.find("textarea");autosize(b),b.on("keydown",null,"ctrl+return",function(){b.parents("form").submit()})}}))}();